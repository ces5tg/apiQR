
<%- include('../layouts/head.ejs') %>
<link href="/css/bootstrap.css" rel="stylesheet" />
  <body>
    <div class="wrapped">

      <div class="sidebar">
        <%- include('../layouts/sideBar.ejs') %>
      </div>
      <div class="main-panel ps ps--active-y">
        <div class="navbar navbar-expand-lg navbar-absolute navbar-transparent">
          <%- include('../layouts/navBar.ejs') %>
        </div>
        <div class="content">
          <div class="main-panel">
            <div class="row">
              <div class="col-12">
                <div class="card card-chart">
                  <select name="" id="seleccionaPersona">
                    <% personas.forEach( persona=> { %>
                      <option value="<%= persona._id %>">
                        <%= persona.name %>
                      </option>

                      <% }); %>
                  </select>
                  <select name="" id="seleccionaGrupo">
                    <% grupos.forEach( grupo=> { %>
                      <option value="<%= grupo._id %>">
                        <%= grupo.name %>
                      </option>

                      <% }); %>
                  </select>
                </div>
                <div class="container mt-5">
                  <table class="table table-bordered border-primary">
                    <thead>
                      <tr class="small">
                        <th>Día</th>
                        <th>
                          <p>6:20</p>
                          <p>7:10</p>
                        </th>
                        <th>
                          <p>7:10</p>
                          <p>8:00</p>
                        </th>
                        <th>
                          <p>8:00</p>
                          <p>8:50</p>
                        </th>
                        <th>
                          <p>8:50</p>
                          <p>9:40</p>
                        </th>
                        <th>
                          <p>9:40</p>
                          <p>10:30</p>
                        </th>
                        <th>
                          <p>10:30</p>
                          <p>11:20</p>
                        </th>
                        <th>
                          <p>11:20</p>
                          <p>12:10</p>
                        </th>
                        <th>
                          <p>12:10</p>
                          <p>13:00</p>
                        </th>
                        <th>
                          <p>13:00</p>
                          <p>13:50</p>
                        </th>
                        <th>
                          <p>13:50</p>
                          <p>14:40</p>
                        </th>
                        <th>
                          <p>14:40</p>
                          <p>15:30</p>
                        </th>
                        <th>
                          <p>15:30</p>
                          <p>16:20</p>
                        </th>
                        <th>
                          <p>16:20</p>
                          <p>17:10</p>
                        </th>
                        <th>
                          <p>17:10</p>
                          <p>18:00</p>
                        </th>
                        <th>
                          <p>18:00</p>
                          <p>18:50</p>
                        </th>
                        <th>
                          <p>18:50</p>
                          <p>19:40</p>
                        </th>
                        <th>
                          <p>19:40</p>
                          <p>20:30</p>
                        </th>
                        <th>
                          <p>20:30</p>
                          <p>21:20</p>
                        </th>
                        <th>
                          <p>21:20</p>
                          <p>22:10</p>
                        </th>
                        <th>
                          <p>22:10</p>
                          <p>23:00</p>
                        </th>
                      </tr>
                    </thead>
                    <tbody id="tablaHorario">
                      <% horarios.forEach( horario=> { %>

                        <tr>
                          <td class="bg-warning">
                            <%= horario.dia %>
                          </td>
                          <% horario.horarios.forEach( hora=> { %>
                            <% if (hora.id_horario) { %>
                              <td class="<%= hora.id_horario ? 'bg-primary' : 'bg-success' %>">
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                  data-bs-target="#exampleModal<%=hora.id_horario%>">
                                  <%= hora.nameAula %>-<%= hora.nameCurso%>-<%= hora.namePersona %>
                                </button>
                              </td>
                              <% } else { %>
                                <td class="<%= hora.id_horario ? 'bg-primary' : 'bg-success' %>"></td>
                                <% } %>
                                  <% }); %>
                        </tr>
                        <% }); %>
                    </tbody>
                  </table>
                  <!-- Modal para mostrar información adicional -->
                  <% horarios.forEach( horario=> { %>
                    <% horario.horarios.forEach( hora=> { %>
                      <% if (hora.id_horario) { %>
                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal<%=hora.id_horario%>" tabindex="-1"
                          aria-labelledby="exampleModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <div class="modal-title" id="exampleModalLabel<%= hora.id_horario %>">
                                  Ms detalles
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                  aria-label="Close"></button>
                              </div>
                              <div class="modal-body-2">
                                <div class="card mb-3" style="max-width: 600px;">
                                  <div class="row g-0">
                                    <div class="col-md-4">
                                      <img src="<%= hora.imagenQR %>" class="img-fluid rounded-start" alt="..." />
                                    </div>
                                    <div class="col-md-8">
                                      <div class="card-body">
                                        <div class="card-title">
                                          <%= hora.namePersona %>
                                        </div>
                                        <p class="card-text">Hora Inicio: <%= hora.hora_inicio %>
                                        </p>
                                        <p class="card-text">Hora Fin: <%= hora.hora_fin %>
                                        </p>
                                        <p class="card-text">Curso: <%= hora.nameCurso %>
                                        </p>
                                        <p class="card-text">Aula: <%= hora.nameAula %>
                                        </p>
                                        <p class="card-text">Grupo: <%= hora.nameGrupo %>
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <% } %>
                          <% }); %>
                            <% }); %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Otro código HTML... -->


    <!-- Scripts y estilos necesarios -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  </body>
  <script>
    const seleccionaPersona = document.getElementById("seleccionaPersona");
    const tablaHorarios = document.getElementById("tablaHorario");
    const seleccionaGrupo = document.getElementById("seleccionaGrupo");
    seleccionaPersona.addEventListener("change", () => {
      const filtroPersona = seleccionaPersona.value;
      fetch(`/api/web/horarioTable?selectPersona=${filtroPersona}`)
        .then((response) => response.json())
        .then((data) => {
          horariosHTML(data);
        });
    });
    seleccionaGrupo.addEventListener("change", () => {
      const filtroGrupo = seleccionaGrupo.value;
      fetch(`/api/web/horarioTable?selectGrupo=${filtroGrupo}`)
        .then((response) => response.json())
        .then((data) => {
          horariosHTML(data);
        });
    });
    function horariosHTML(data) {
      tablaHorarios.innerHTML = "";
      data.forEach((resultados) => {
        const tr = document.createElement("tr");

        tr.innerHTML = `<tr>
                <td class='bg-warning'>${resultados.dia}</td>
                </tr>`;

        resultados.horarios.forEach((horario) => {
          const td = document.createElement("td");
          td.className = horario.id_horario ? "bg-primary" : "bg-success";

          if (horario.id_horario) {
            const button = document.createElement("button");
            button.type = "button";
            button.className = "btn btn-primary";
            button.setAttribute("data-bs-toggle", "modal");
            button.setAttribute("data-bs-target", `#exampleModal${horario.id_horario}`);
            button.innerHTML = `${horario.hora_inicio}-${horario.hora_fin}-${horario.nameAula}-${horario.nameCurso}-${horario.namePersona}-${horario.nameGrupo}`;

            td.appendChild(button);
          }

          tr.appendChild(td);
        });

        tablaHorarios.appendChild(tr);

      });
    }
  </script>

  </html>